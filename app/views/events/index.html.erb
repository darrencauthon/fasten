<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<link type="text/css" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" />

<h1>Events</h1>

<div id='mynetwork'></div>

<script type="text/javascript">
  retrieveEvents().then(events => showEventBubbles(events));

  function retrieveEvents() {
    var promise = new Promise((resolve, reject) => {

      var xhr = new XMLHttpRequest();
      xhr.onload = function() {
        if (xhr.status >= 200 && xhr.status < 300) {
          var events = JSON.parse(xhr.response);
          resolve(events);
        } else {
          alert('Request failed, see console');
          console.error('Request failed', xhr);
          reject();
        }
      };

      xhr.open('GET', '/events/all');
      xhr.send();
    });

    return promise;
  }

  function showEventBubbles(events) {
    var nodes = new vis.DataSet(events.map(thisEvent => {
      return {
        id: thisEvent.id,
        label: thisEvent.message
      };
    }));

    var edges = new vis.DataSet([]);

    var container = document.getElementById('mynetwork');
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {};
    var network = new vis.Network(container, data, options);
  }
</script>