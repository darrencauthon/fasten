<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function(){
    jQuery('.use_this').click(function(x){
      jQuery('#type').val(jQuery(x.target).data('type'));
    });

    jQuery('#create').click(function() {
      var data = {
      }

      jQuery('[data-map]').each(function(_, x) {
        data[jQuery(x).data('map')] = jQuery(x).val();
      });

      jQuery.post('/overt/workflow/create-step/<%=h @workflow.id %>', data, function(){
        window.location = '/overt/workflow/view-step/' + data.workflow_id + '/' + data.id;
      });
      console.log(data);
    });
  });
</script>

<h1><%=h @workflow.id %></h1>
<fieldset>
  <legend>Step</legend>
  <% @step_types.each do |step_type| %>
    <details>
      <summary><%=h step_type[:name] %></summary>
      <p>
        <%=h step_type[:name] %>
      </p>
      <button data-type="<%= step_type[:id] %>" class="use_this">Use This</button>
    </details>
  <% end %>
</fieldset>
<fieldset>
  <legend>Fields</legend>
    <label for="id">Id</label>
    <input type="text" name="id" value="<%=h SecureRandom.uuid %>" data-map="id" required>

    <label for="name">Name</label>
    <input type="text" name="name" value="" data-map="name" required>

    <label for="type">Type</label>
    <input readonly type="text" name="type" value="" data-map="type" id="type">

    <label for="message">Message</label>
    <input type="text" name="message" value="" data-map="message" id="message">

    <label for="merge">Merge</label>
    <input type="text" name="merge" value="*" data-map="merge" id="merge">

    <input type="hidden" value="<%=h @parent_step_id %>" data-map="parent_step_id">
    <input type="hidden" value="<%=h @workflow.id %>" data-map="workflow_id">
    <input type="hidden" value="<%=h @event_id %>" data-map="event_id">
    <button id="create">Create This Step</button>
</fieldset>